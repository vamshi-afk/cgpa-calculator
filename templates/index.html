<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GPA Toolkit</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<style>
body { background:#0f1115; color:#e6e6e6; }
.container { max-width:720px; }

.card {
  background:#151922;
  border:1px solid #232838;
}

.nav-tabs {
  border:none;
  background:#121722;
  border-radius:10px;
  padding:4px;
}
.nav-tabs .nav-item { width:50%; }

.nav-tabs .nav-link {
  border:none;
  border-radius:8px;
  color:#aab0c0;
  padding:10px 0;
}
.nav-tabs .nav-link.active {
  background:#1b2233;
  color:#fff;
  box-shadow:inset 0 0 0 1px #2a3042;
}

.form-control, .form-select {
  background:#0f1115;
  border:1px solid #2a3042;
  color:#e6e6e6;
}
.form-control:focus, .form-select:focus {
  border-color:#4c7dff;
  box-shadow:none;
}

.alert-success { background:#143022; border:none; color:#6ee7b7; }
.alert-info { background:#10263f; border:none; color:#7dd3fc; }

.tab-pane:not(.show) { display:none; }

@media (max-width:576px){
  .container { padding:8px; }
}
</style>
</head>

<body>

<div class="container mt-3">

<h6 class="text-center mb-3">GPA Toolkit</h6>

<!-- Tabs -->
<ul class="nav nav-tabs nav-fill mb-3">
  <li class="nav-item">
    <button class="nav-link {% if active_tab=='sgpa' %}active{% endif %}"
            data-bs-toggle="tab" data-bs-target="#sgpa">SGPA</button>
  </li>
  <li class="nav-item">
    <button class="nav-link {% if active_tab=='estimator' %}active{% endif %}"
            data-bs-toggle="tab" data-bs-target="#estimator">Estimator</button>
  </li>
</ul>

<div class="tab-content">

<!-- SGPA -->
<div class="tab-pane fade {% if active_tab=='sgpa' %}show active{% endif %}" id="sgpa">
<div class="card"><div class="card-body">

<form method="POST" action="/sgpa">

<div class="d-flex justify-content-between align-items-center mb-2">

  <div class="ps-1">
    <small class="text-secondary">Subjects</small>
  </div>

<div class="btn-group">

{% for n in range(5,9) %}
<input type="radio" class="btn-check" name="subject_count"
       id="sub{{n}}" {% if n==5 %}checked{% endif %}
       onclick="generateSubjects({{n}})">
<label class="btn btn-outline-primary px-3" for="sub{{n}}">{{n}}</label>
{% endfor %}
</div>
</div>

<hr>

<div id="subjects"></div>

<button class="btn btn-primary w-100 mt-2">Calculate SGPA</button>
</form>

{% if sgpa %}
<div class="alert alert-success mt-3 d-flex justify-content-between">
  <small>Your SGPA</small>
  <strong>{{ sgpa }}</strong>
</div>
{% endif %}

</div></div>
</div>

<!-- ESTIMATOR -->
<div class="tab-pane fade {% if active_tab=='estimator' %}show active{% endif %}" id="estimator">
<div class="card"><div class="card-body">

<form method="POST" action="/estimator">

<input type="number" step="0.01" name="current_cgpa" class="form-control mb-2"
       placeholder="Current CGPA" value="{{ est_current_cgpa }}" required>

<input type="number" step="1" name="current_credits" class="form-control mb-2"
       placeholder="Total Credits" value="{{ est_current_credits }}" required>

<input type="number" step="1" name="sem_credits" class="form-control mb-2"
       placeholder="Semester Credits" value="{{ est_sem_credits }}" required>

<input type="number" step="0.01" name="target_cgpa" class="form-control mb-2"
       placeholder="Target CGPA" value="{{ est_target_cgpa }}" required>

<button class="btn btn-success w-100">Required SGPA</button>
</form>

{% if required_sgpa %}
<div class="alert alert-info mt-3">
  <strong>{{ required_sgpa }}</strong><br>
  <small>{{ message }}</small>
</div>
{% endif %}

</div></div>
</div>

</div>
</div>

<script>
function generateSubjects(count, oldCredits=[], oldGrades=[]) {
  const container=document.getElementById("subjects");
  container.innerHTML="";
  const grades=["S","A+","A","B+","B","C","D","E","NC"];

  for(let i=0;i<count;i++){
    container.innerHTML+=`
    <div class="row g-2 mb-1">
      <div class="col-6">
        <input type="number" step="1" name="credits" class="form-control"
               placeholder="Credits ${i+1}" value="${oldCredits[i]||''}" required>
      </div>
      <div class="col-6">
        <select name="grade" class="form-select">
          ${grades.map(g=>`<option ${g===oldGrades[i]?"selected":""}>${g}</option>`).join("")}
        </select>
      </div>
    </div>`;
  }
}

document.addEventListener("DOMContentLoaded",()=>{
  const nav=performance.getEntriesByType("navigation")[0]?.type;

  if(nav==="reload"){
    document.querySelectorAll("form").forEach(f=>f.reset());
    document.getElementById("subjects").innerHTML="";
    generateSubjects(5);
    return;
  }

  const oldCredits={{ old_credits|tojson if old_credits else 'null' }};
  const oldGrades={{ old_grades|tojson if old_grades else 'null' }};

  if(oldCredits) generateSubjects(oldCredits.length,oldCredits,oldGrades);
  else generateSubjects(5);

  // Keep tab in URL
  document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tab=>{
    tab.addEventListener('shown.bs.tab',e=>{
      const id=e.target.dataset.bsTarget.replace("#","");
      const url=new URL(window.location);
      url.searchParams.set("tab",id);
      history.replaceState(null,"",url);
    });
  });
});
</script>

</body>
</html>
